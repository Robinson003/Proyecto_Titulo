{% extends "base.html" %}
{% load static %}
{% block title %}Inicio{% endblock %}

{% block content %}

<!-- Carrusel -->
<div id="mainCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{% static 'img/piscina4.jpg' %}" class="d-block w-100 banner-img" alt="Obras Públicas 1">
      <div class="carousel-caption d-none d-md-block">
        <h3></h3>
        <p></p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="{% static 'img/slide2.jpg' %}" class="d-block w-100 banner-img" alt="Obras Públicas 2">
      <div class="carousel-caption d-none d-md-block">
        <h3></h3>
        <p></p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="{% static 'img/slide3.jpg' %}" class="d-block w-100 banner-img" alt="Obras Públicas 3">
      <div class="carousel-caption d-none d-md-block">
        <h3></h3>
        <p></p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>

<!-- Bienvenida personalizada -->
<div class="text-center mb-5">
  {% if user.is_authenticated %}
    <h2>¡Bienvenido {{ user.first_name|default:user.username }}!</h2>
    <p class="text-muted">¿Qué deseas hacer hoy?</p>
  {% else %}
    <h2>Bienvenido al Portal del Ministerio de Obras Públicas</h2>
    <p class="text-muted">Gestione sus citas, revise información y manténgase conectado con nuestros servicios.</p>
    <a href="{% url 'register' %}" class="btn btn-primary btn-lg me-2">Crear cuenta</a>
    <a href="{% url 'login' %}" class="btn btn-outline-primary btn-lg">Iniciar sesión</a>
  {% endif %}
</div>

<!-- Tarjetas según el rol del usuario -->
<div class="row text-center">
  
  {% if user.is_authenticated %}
    <!-- TARJETAS PARA USUARIOS VIP -->
    {% for group in user.groups.all %}
      {% if group.name == 'VIP' %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-primary">
            <div class="card-body">
              <i class="fas fa-calendar-plus fa-3x text-primary mb-3"></i>
              <h5 class="card-title">Solicitar Cita</h5>
              <p class="card-text">Agenda una nueva cita con nuestro equipo fácilmente.</p>
              <a href="{% url 'request_appointment' %}" class="btn btn-primary">Solicitar ahora</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-primary">
            <div class="card-body">
              <i class="fas fa-list fa-3x text-primary mb-3"></i>
              <h5 class="card-title">Mis Citas</h5>
              <p class="card-text">Revisa el estado de tus citas agendadas y tu historial.</p>
              <a href="{% url 'my_appointments' %}" class="btn btn-primary">Ver citas</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-primary">
            <div class="card-body">
              <i class="fas fa-calendar fa-3x text-primary mb-3"></i>
              <h5 class="card-title">Calendario</h5>
              <p class="card-text">Visualiza tus citas en un calendario interactivo.</p>
              <a href="{% url 'calendar' %}" class="btn btn-primary text-white">Ir al calendario</a>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}

    <!-- TARJETAS PARA TRABAJADORES -->
    {% for group in user.groups.all %}
      {% if group.name == 'Trabajadores' or user.is_staff %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-warning">
            <div class="card-body">
              <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
              <h5 class="card-title">Dashboard Admin</h5>
              <p class="card-text">Estadísticas y métricas del sistema de citas.</p>
              <a href="{% url 'worker_dashboard' %}" class="btn btn-warning">Ver dashboard</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-danger">
            <div class="card-body">
              <i class="fas fa-tasks fa-3x text-danger mb-3"></i>
              <h5 class="card-title">Gestionar Citas</h5>
              <p class="card-text">Aprobar, rechazar o modificar citas pendientes.</p>
              <a href="{% url 'manage_appointments' %}" class="btn btn-danger">Gestionar</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm border-secondary">
            <div class="card-body">
              <i class="fas fa-clock fa-3x text-secondary mb-3"></i>
              <h5 class="card-title">Horarios</h5>
              <p class="card-text">Configura los horarios disponibles para citas.</p>
              <a href="{% url 'manage_slots' %}" class="btn btn-secondary">Configurar</a>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}

  {% else %}
    <!-- TARJETAS PARA VISITANTES (no autenticados) -->
    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="{% static 'img/calendario1.jpg' %}" class="card-img-top banner-img" alt="Gestión de Citas">
        <div class="card-body">
          <h5 class="card-title">Gestión de Citas</h5>
          <p class="card-text">Agende y administre sus reuniones con nuestros funcionarios fácilmente.</p>
          <a href="{% url 'register' %}" class="btn btn-primary">Crear cuenta</a>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="{% static 'img/consultas1.png' %}" class="card-img-top banner-img" alt="Consultas">
        <div class="card-body">
          <h5 class="card-title">Consultas Ciudadanas</h5>
          <p class="card-text">Realice consultas o sugerencias relacionadas con obras y proyectos.</p>
          <a href="{% url 'contact' %}" class="btn btn-primary">Contacto</a>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm">
        <img src="{% static 'img/login1.jpg' %}" class="card-img-top banner-img" alt="Perfil">
        <div class="card-body">
          <h5 class="card-title">Portal Digital</h5>
          <p class="card-text">Acceda a servicios digitales y gestione su cuenta.</p>
          <a href="{% url 'login' %}" class="btn btn-primary">Iniciar sesión</a>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<!-- Sección informativa -->
<div class="row mt-5">
  <div class="col-12">
    <div class="alert alert-info text-center">
      <h4><i class="fas fa-info-circle me-2"></i>¿Cómo funciona?</h4>
      <p class="mb-0">
        1️⃣ Crea tu cuenta • 2️⃣ Solicita una cita • 3️⃣ Espera confirmación • 4️⃣ Asiste a tu cita
      </p>
    </div>
  </div>
</div>

{% endblock %}

{% block head %}
<style>
  .banner-img {
    width: 100%;
    height: 333px;
    object-fit: cover;
  }

  @media (max-width: 768px) {
    .banner-img {
      height: 240px;
    }
  }

  .card {
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
  }
</style>
{% endblock %}